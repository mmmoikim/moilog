<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2. 메모리 | MOILOG</title>
    <meta name="description" content="Hello! I&#39;m web developer. this is study blog.">
    <meta name="google-site-verification" content="Np5Qu68ys0COB1T9fZ8rfxfrr_SLcHqzfmu9Q03K8YY">
    
    <link rel="preload" href="/moilog/assets/css/0.styles.6ef3f76f.css" as="style"><link rel="preload" href="/moilog/assets/js/app.ae515986.js" as="script"><link rel="preload" href="/moilog/assets/js/13.eb2c8d3f.js" as="script"><link rel="prefetch" href="/moilog/assets/js/10.47d880df.js"><link rel="prefetch" href="/moilog/assets/js/11.dff6fbc0.js"><link rel="prefetch" href="/moilog/assets/js/12.67e84a35.js"><link rel="prefetch" href="/moilog/assets/js/14.b66233e1.js"><link rel="prefetch" href="/moilog/assets/js/15.42b1e262.js"><link rel="prefetch" href="/moilog/assets/js/16.38463800.js"><link rel="prefetch" href="/moilog/assets/js/17.d9e791e4.js"><link rel="prefetch" href="/moilog/assets/js/18.3d9a233f.js"><link rel="prefetch" href="/moilog/assets/js/19.b4485bbc.js"><link rel="prefetch" href="/moilog/assets/js/20.e9f46bc7.js"><link rel="prefetch" href="/moilog/assets/js/21.e0dcecb4.js"><link rel="prefetch" href="/moilog/assets/js/22.0c1252c7.js"><link rel="prefetch" href="/moilog/assets/js/23.fb1571df.js"><link rel="prefetch" href="/moilog/assets/js/24.aa6c24c2.js"><link rel="prefetch" href="/moilog/assets/js/25.61f24dec.js"><link rel="prefetch" href="/moilog/assets/js/26.0c042d9c.js"><link rel="prefetch" href="/moilog/assets/js/27.02c89de4.js"><link rel="prefetch" href="/moilog/assets/js/28.b4444a46.js"><link rel="prefetch" href="/moilog/assets/js/29.c74e9844.js"><link rel="prefetch" href="/moilog/assets/js/3.2d797fd0.js"><link rel="prefetch" href="/moilog/assets/js/30.bc640131.js"><link rel="prefetch" href="/moilog/assets/js/31.9dba47c1.js"><link rel="prefetch" href="/moilog/assets/js/32.2e1c33c2.js"><link rel="prefetch" href="/moilog/assets/js/33.a94204db.js"><link rel="prefetch" href="/moilog/assets/js/34.473e8ca3.js"><link rel="prefetch" href="/moilog/assets/js/35.87817426.js"><link rel="prefetch" href="/moilog/assets/js/36.5c0a4dae.js"><link rel="prefetch" href="/moilog/assets/js/37.d97fa9ca.js"><link rel="prefetch" href="/moilog/assets/js/38.80d4853a.js"><link rel="prefetch" href="/moilog/assets/js/39.920784a2.js"><link rel="prefetch" href="/moilog/assets/js/4.9adc46b6.js"><link rel="prefetch" href="/moilog/assets/js/40.2ad76590.js"><link rel="prefetch" href="/moilog/assets/js/41.64ecf26b.js"><link rel="prefetch" href="/moilog/assets/js/42.19e25c0a.js"><link rel="prefetch" href="/moilog/assets/js/43.af9173eb.js"><link rel="prefetch" href="/moilog/assets/js/44.6d8303aa.js"><link rel="prefetch" href="/moilog/assets/js/45.ec931762.js"><link rel="prefetch" href="/moilog/assets/js/46.c455561e.js"><link rel="prefetch" href="/moilog/assets/js/47.1b6ebe90.js"><link rel="prefetch" href="/moilog/assets/js/48.7e50bdca.js"><link rel="prefetch" href="/moilog/assets/js/49.eeb5be00.js"><link rel="prefetch" href="/moilog/assets/js/5.9c1ee8f1.js"><link rel="prefetch" href="/moilog/assets/js/50.8d4d21e5.js"><link rel="prefetch" href="/moilog/assets/js/51.7f4c6f81.js"><link rel="prefetch" href="/moilog/assets/js/52.27c9acd3.js"><link rel="prefetch" href="/moilog/assets/js/53.3dccbb50.js"><link rel="prefetch" href="/moilog/assets/js/6.b4a4f99c.js"><link rel="prefetch" href="/moilog/assets/js/7.77d08323.js"><link rel="prefetch" href="/moilog/assets/js/8.07a7ae9c.js"><link rel="prefetch" href="/moilog/assets/js/9.e07a472c.js"><link rel="prefetch" href="/moilog/assets/js/vendors~docsearch.a77ba3c3.js">
    <link rel="stylesheet" href="/moilog/assets/css/0.styles.6ef3f76f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/moilog/" class="home-link router-link-active"><img src="/moilog/logo.png" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/moilog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/moilog/post/list.html" class="nav-link">Post</a></div> <a href="https://github.com/mmmoikim/moilog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/moilog/" class="nav-link">Home</a></div><div class="nav-item"><a href="/moilog/post/list.html" class="nav-link">Post</a></div> <a href="https://github.com/mmmoikim/moilog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>WEB</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>REACT</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>VUE</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>how javascript work</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/moilog/post/hjw/hjw-1-browser.html" class="sidebar-link">1. 브라우저 구성과 엔진</a></li><li><a href="/moilog/post/hjw/hjw-2-memory.html" class="active sidebar-link">2. 메모리</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/moilog/post/hjw/hjw-2-memory.html#정적-할당" class="sidebar-link">정적 할당</a></li><li class="sidebar-sub-header"><a href="/moilog/post/hjw/hjw-2-memory.html#동적-할당" class="sidebar-link">동적 할당</a></li><li class="sidebar-sub-header"><a href="/moilog/post/hjw/hjw-2-memory.html#가비지-콜렉터" class="sidebar-link">가비지 콜렉터</a></li><li class="sidebar-sub-header"><a href="/moilog/post/hjw/hjw-2-memory.html#메모리-누수" class="sidebar-link">메모리 누수</a></li><li class="sidebar-sub-header"><a href="/moilog/post/hjw/hjw-2-memory.html#reference" class="sidebar-link">reference</a></li></ul></li><li><a href="/moilog/post/hjw/hjw-3-websocket.html" class="sidebar-link">3. websockek과 HTTP/2 + SSE</a></li><li><a href="/moilog/post/hjw/hjw-4-wasm.html" class="sidebar-link">4. 웹어셈블리</a></li><li><a href="/moilog/post/hjw/hjw-5-webworker.html" class="sidebar-link">5. webworker</a></li><li><a href="/moilog/post/hjw/hjw-6-webpush.html" class="sidebar-link">6. web push notifications</a></li><li><a href="/moilog/post/hjw/hjw-rendering.html" class="sidebar-link">rendering</a></li><li><a href="/moilog/post/hjw/hjw-references.html" class="sidebar-link">references</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>java</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Etc</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"><div class="page-mask"> <div class="content"><h1 id="_2-메모리"><a href="#_2-메모리" aria-hidden="true" class="header-anchor">#</a> 2. 메모리</h1> <ul><li><a href="#2-%EB%A9%94%EB%AA%A8%EB%A6%AC">2. 메모리</a> <ul><li><a href="#%EC%A0%95%EC%A0%81-%ED%95%A0%EB%8B%B9">정적 할당</a></li> <li><a href="#%EB%8F%99%EC%A0%81-%ED%95%A0%EB%8B%B9">동적 할당</a></li> <li><a href="#%EA%B0%80%EB%B9%84%EC%A7%80-%EC%BD%9C%EB%A0%89%ED%84%B0">가비지 콜렉터</a></li> <li><a href="#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98">메모리 누수</a></li> <li><a href="#reference">reference</a></li></ul></li></ul> <h2 id="정적-할당"><a href="#정적-할당" aria-hidden="true" class="header-anchor">#</a> 정적 할당</h2> <ul><li>코드를 컴파일하며 컴파일러는 필요한 메모리를 계산해 <code>stack space</code> 라는 곳에서 프로그램을 할당 한다.</li> <li>함수에서 함수를 부를 때 함수 각 각 불려지는 시점에 자신의 로컬 변수를 포함하는 스택청크를 가지게 되고<br>
실행중인 부분을 프로그램 카운터가 기억한다. 그리고 함수가 끝나면 이 메모리 블럭은 해제된다.</li></ul> <h2 id="동적-할당"><a href="#동적-할당" aria-hidden="true" class="header-anchor">#</a> 동적 할당</h2> <ul><li>컴파일러가 정확한 메모리 공간을 계산하지 못한다면 힙영역에 적당한 공간을 요청한다.</li></ul> <p><img src="/moilog/assets/img/how-javascript-work-8.7b053698.png" alt="정적, 동적할당 차이"></p> <ul><li>javscript는 숫자, 문자, 객체, 배열, 함수에 대해서 스스로 할당 한다.</li></ul> <h2 id="가비지-콜렉터"><a href="#가비지-콜렉터" aria-hidden="true" class="header-anchor">#</a> 가비지 콜렉터</h2> <ul><li>메모리 할당을 추적하고 할당된 메모리가 더이상 필요 없어졌을때 해제하는 작업을 한다.</li> <li>Reference-counting 알고리즘 : 아무도 참조하지 않는 오브젝트가 있다면 가비지 콜렉션을 수행한다. 인터넷 익스플로러 6, 7 에서 쓰임</li> <li>Reference-counting 알고리즘은 순환참조가 되면 (서로 값을 참조하고 있다면) 메모리 해제가 안되는 한계점이 있다.</li> <li>Mark-and-sweep 알고리즘 : 주기적으로 가비지 콜렉터는 오브젝트 집합의 roots(window객체)에서 시작해 닿을 수 없는 오브젝트에 대해 수행한다. 순환참조의 한계점을 극복할 수 있다.</li> <li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Memory_Management" target="_blank" rel="noopener noreferrer">mozilla<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="메모리-누수"><a href="#메모리-누수" aria-hidden="true" class="header-anchor">#</a> 메모리 누수</h2> <ul><li>어떤 메모리가 사용 중 인지 아닌지는 non-determinism, 결정할 수 없다.</li> <li>가비지 콜렉터는 닿을 수 없는 상태여도 메모리에 할당이 일어나지 않으면 수집하지 않는다.</li> <li>메모리 누수는 프로그램에서 사용했다가 더 이상 필요하지 않은 상태가 되었을 때 반환되지 않은 메모리를 말한다.</li></ul> <ol><li>전역변수
<ul><li>선언하지 않은 변수를 사용했을때 혹은 this를 사용했을때 전역변수(window)에 값이 할당된다.</li> <li>가비지컬렉터가 정리 할 수 없는 전역변수를 쓰지 않게 주의 해야하고 전역변수를 다 쓰고 난 후에 null로 비워야한다.</li></ul></li> <li>타이머, 콜백함수
<ul><li>옵져버가 계속 사용되고 있으면 가비지 컬렉터가 가져가지 않기 때문에 사용 후에는 제거해야한다.</li> <li><code>setInterval</code>, <code>addEventListener</code></li> <li>최신 브라우져 가비지컬렉터는 순환참조가 되고 있거나 살아있는 리스너가 있을때에도 가져간다.</li></ul></li> <li>클로져</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> theThing <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">replaceThing</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">var</span> originalThing <span class="token operator">=</span> theThing<span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token function-variable function">unused</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>originalThing<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        theThing <span class="token operator">=</span> <span class="token punctuation">{</span>
            longStr<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">someMethod</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span>replaceThing<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ul><li>클로져는 외부함수의 지역변수를 사용하는 내부함수가 소멸될 때까지 외부함수가 소멸되지 않는 특성을 의미한다.</li> <li><strong>동일한 외부 스코프에 있는 내부함수들은 스코프가 공유된다</strong>.</li> <li><code>someMethod</code> 최상위 스코프에 <code>theThing</code> 참조하고 있기 때문에 <code>replaceThing</code>이 끝나도 활성 상태</li> <li><code>unused</code> 와 <code>someMethod</code>는 클로져 스코프 공유</li> <li><code>unused</code>는 <code>originalThing</code>을 참조</li> <li><code>unused</code>는 쓰이지 않지만 <code>someMethod</code>와 스코프를 공유하면서 계속 활성상태로 남는다.</li></ul> <ol start="4"><li>Out of DOM references
<ul><li>돔 노드에 대한 참조가 있는 변수는 돔이 삭제될때 같이 제거해 줘야한다.</li> <li>돔 트리에 리프노드나 자식노드를 참조할 때 만약 부모 돔을 제거 하고 참조가 남아있다면 부모돔트리 전체가 메모리에 남아있게 된다.</li></ul></li></ol> <h2 id="reference"><a href="#reference" aria-hidden="true" class="header-anchor">#</a> reference</h2> <ul><li><a href="https://blog.sessionstack.com/how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks-3f28b94cfbec" target="_blank" rel="noopener noreferrer">How JavaScript works: memory management + how to handle 4 common memory leaks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div id="disqus_thread"></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/mmmoikim/moilog/edit/master/docs/post/hjw/hjw-2-memory.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/5/2019, 8:35:09 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
          ← <a href="/moilog/post/hjw/hjw-1-browser.html" class="prev">
            1. 브라우저 구성과 엔진
          </a></span> <span class="next"><a href="/moilog/post/hjw/hjw-3-websocket.html">
            3. websockek과 HTTP/2 + SSE
          </a> →
        </span></p> </div></div></div></div></div>
    <script src="/moilog/assets/js/app.ae515986.js" defer></script><script src="/moilog/assets/js/13.eb2c8d3f.js" defer></script>
  </body>
</html>
